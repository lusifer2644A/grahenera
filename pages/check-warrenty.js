import Footer from "@/components/Footer";
import TextInput from "@/components/inputs/TextInput";
import Loader from "@/components/Loader/Loader";
import Navbar from "@/components/Navbar";
import PageNav from "@/components/pageNavigation/PageNav";
import Head from "next/head";
import { useState } from "react";
import styles from "../styles/checkWarrenty.module.scss";
import PrimaryButton from "@/components/buttons/PrimaryButton";
import axios from "axios";

const home = () => {
  const [serialNoInput, setSerialNoInput] = useState();
  const [warrentyDetails, setWarrentyDetails] = useState();
  const [loading, setLoading] = useState(false);

  const checkWarrenty = async () => {
    setLoading(true);
    try {
      const body = {
        serial_no: serialNoInput,
      };
      const res = await axios.post("/api/factory/checkSerial", body);
      console.log(res);

      setWarrentyDetails(res.data);
      toast.success(`Successfully fetched all products`);
    } catch (err) {
      console.log(err);
    }
    setLoading(false);
  };

  const colors = {
    warning: "ffbb33",
    error: "ff4444",
    success: "00c851",
  };

  console.log(warrentyDetails);

  const currrent_date = new Date();
  const epoch_date = currrent_date.getTime();
  console.log(
    warrentyDetails?.data?.date_expiry,
    epoch_date,
    warrentyDetails?.data?.date_expiry < epoch_date
  );
  const validWarrenty =
    warrentyDetails?.data?.date_expiry > new Date().getTime();

  return (
    <>
      <Head>
        <title>Graphene Pro - Warrenty</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/images/logo_sm.png" />
      </Head>
      <main className="main">
        <Navbar />
        <PageNav title="Check Warrenty" />
        <div className="pageContainer">
          {loading && <Loader />}
          <div className={styles.productChooseContainer}>
            <p className="subtitle">Enter Serial No.</p>
            <p className="caption-text">
              Enter serial number of product for which warrenty need to be
              checked
            </p>
            <div className={styles.inputContainer}>
              <div className={styles.inputBox}>
                <TextInput
                  id="outlined-name"
                  label="Serial No"
                  name="serialNoInput"
                  fullWidth={true}
                  value={serialNoInput}
                  onChange={(e) => setSerialNoInput(e.target.value)}
                />
              </div>
              {warrentyDetails && (
                <div className={styles.warrenty_conditions}>
                  {/* Invalid serial id */}
                  {warrentyDetails.status === 0 ? (
                    <div className={styles.statements}>
                      <div className={styles.icon}>
                        <img src={`/images/icons/error.png`} />
                      </div>
                      <p
                        style={{ fontWeight: "500" }}
                        className={`caption-text error`}
                      >
                        Serial Number not registered
                      </p>
                    </div>
                  ) : (
                    <div className={styles.statements}>
                      <div className={styles.icon}>
                        <img src={`/images/icons/success.png`} />
                      </div>
                      <p
                        style={{ fontWeight: "500" }}
                        className={`caption-text success`}
                      >
                        Registered serial number
                      </p>
                    </div>
                  )}

                  {/* Valid serial id and valid warrenty*/}
                  {warrentyDetails.status === 1 && validWarrenty && (
                    <div className={styles.statements}>
                      <div className={styles.icon}>
                        <img src={`/images/icons/success.png`} />
                      </div>
                      <p
                        style={{ fontWeight: "500" }}
                        className={`caption-text success`}
                      >
                        Warrenty Covered
                      </p>
                    </div>
                  )}

                  {/* Valid serial id and invalid warrenty*/}
                  {warrentyDetails.status === 1 && !validWarrenty && (
                    <div className={styles.statements}>
                      <div className={styles.icon}>
                        <img src={`/images/icons/shield.png`} />
                      </div>
                      <p
                        style={{ fontWeight: "500" }}
                        className={`caption-text warning`}
                      >
                        Warrenty expired
                      </p>
                    </div>
                  )}
                </div>
              )}
            </div>

            <div className={styles.generatebutton}>
              <PrimaryButton name="Check" onClick={checkWarrenty}>
                Check
              </PrimaryButton>
            </div>
          </div>
        </div>
        <Footer />
      </main>
    </>
  );
};

export default home;
