import Footer from "@/components/Footer";
import TextInput from "@/components/inputs/TextInput";
import Loader from "@/components/Loader/Loader";
import Navbar from "@/components/Navbar";
import PageNav from "@/components/pageNavigation/PageNav";
import Head from "next/head";
import { useState } from "react";
import styles from "../styles/checkWarrenty.module.scss";
import PrimaryButton from "@/components/buttons/PrimaryButton";
import axios from "axios";

const home = () => {
  const [serialNoInput, setSerialNoInput] = useState();
  const [warrentyDetails, setWarrentyDetails] = useState();
  const [loading, setLoading] = useState(false);

  const checkWarrenty = async () => {
    setWarrentyDetails({});
    setLoading(true);
    try {
      const body = {
        serial_no: serialNoInput,
      };
      const res = await axios.post("/api/factory/checkSerial", body);
      console.log(res);
      setWarrentyDetails(res.data);
    } catch (err) {
      console.log(err);
    }
    setLoading(false);
  };

  const colors = {
    warning: "ffbb33",
    error: "ff4444",
    success: "00c851",
  };

  const currrent_date = new Date();
  const epoch_date = currrent_date.getTime();

  let date_added_read = new Date(warrentyDetails?.data?.date_added);
  date_added_read = date_added_read.toLocaleDateString();

  let date_expiru_read = new Date(warrentyDetails?.data?.date_expiry);
  date_expiru_read = date_expiru_read.toLocaleDateString();

  const validWarrenty =
    warrentyDetails?.data?.date_expiry > new Date().getTime();

  return (
    <>
      <Head>
        <title>Graphene Pro - Warranty</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/images/logo_sm.png" />
      </Head>
      <main className="main">
        <Navbar />
        <PageNav title="Check Warranty" />
        <div className="pageContainer">
          {loading && <Loader />}
          <div className={styles.productChooseContainer}>
            <h3 className="subtitle">Enter Serial No.</h3>
            <h1 className="caption-text">
              Enter serial number of product for which warrenty need to be
              checked
            </h1>
            <div className={styles.inputContainer}>
              <div className={styles.inputBox}>
                <TextInput
                  id="outlined-name"
                  label="Serial No"
                  name="serialNoInput"
                  fullWidth={true}
                  value={serialNoInput}
                  onChange={(e) => setSerialNoInput(e.target.value)}
                />
              </div>
              <div className={styles.generatebutton}>
                <PrimaryButton name="Check" onClick={checkWarrenty}>
                  Check
                </PrimaryButton>
              </div>

              {warrentyDetails && (
                <div className={styles.productInfoSection}>
                  {warrentyDetails.status !== 0 && (
                    <div className={styles.productInfo}>
                      <div className={styles.productInfoRow}>
                        <h3 className="caption-text">Product Name:</h3>
                        <h1 className="caption-text">
                          {warrentyDetails?.data?.product_name}
                        </h1>
                      </div>
                      <div className={styles.productInfoRow}>
                        <h3 className="caption-text">Product Id:</h3>
                        <h1 className="caption-text">
                          {warrentyDetails?.data?.product_id}
                        </h1>
                      </div>
                      <div className={styles.productInfoRow}>
                        <h3 className="caption-text">Unit Serial No.:</h3>
                        <h1 className="caption-text">
                          {warrentyDetails?.data?.serial_no}
                        </h1>
                      </div>
                      <div className={styles.productInfoRow}>
                        <h3 className="caption-text">Manufacturing Date:</h3>
                        <h1 className="caption-text">{date_added_read}</h1>
                      </div>
                      <div className={styles.productInfoRow}>
                        <h3 className="caption-text">Expiry Date:</h3>
                        <h1 className="caption-text">{date_expiru_read}</h1>
                      </div>
                    </div>
                  )}
                  <div className={styles.warrenty_conditions}>
                    {/* Invalid serial id */}
                    {warrentyDetails.status === 0 ? (
                      <div className={styles.statements}>
                        <div className={styles.icon}>
                          <img src={`/images/icons/error.png`} />
                        </div>
                        <p
                          style={{ fontWeight: "500" }}
                          className={`caption-text error`}
                        >
                          Serial Number not registered
                        </p>
                      </div>
                    ) : (
                      <div className={styles.statements}>
                        <div className={styles.icon}>
                          <img src={`/images/icons/success.png`} />
                        </div>
                        <p
                          style={{ fontWeight: "500" }}
                          className={`caption-text success`}
                        >
                          Registered serial number
                        </p>
                      </div>
                    )}

                    {/* Valid serial id and valid warrenty*/}
                    {warrentyDetails.status === 1 && validWarrenty && (
                      <div className={styles.statements}>
                        <div className={styles.icon}>
                          <img src={`/images/icons/success.png`} />
                        </div>
                        <p
                          style={{ fontWeight: "500" }}
                          className={`caption-text success`}
                        >
                          Warranty Covered
                        </p>
                      </div>
                    )}

                    {/* Valid serial id and invalid warrenty*/}
                    {warrentyDetails.status === 1 && !validWarrenty && (
                      <div className={styles.statements}>
                        <div className={styles.icon}>
                          <img src={`/images/icons/shield.png`} />
                        </div>
                        <p
                          style={{ fontWeight: "500" }}
                          className={`caption-text warning`}
                        >
                          Warranty expired
                        </p>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
        <Footer />
      </main>
    </>
  );
};

export default home;
